# Database (recommended: Postgres via docker-compose)
# NOTE: If you run the backend on your host machine (not in Docker), use localhost + POSTGRES_PORT.
# If you run the backend as the docker-compose service, DATABASE_URL is set inside the container automatically.
DATABASE_URL=postgresql+psycopg://pharmacy:pharmacy@localhost:15432/pharmacy
DB_AUTO_CREATE=0

POSTGRES_DB=pharmacy
POSTGRES_USER=pharmacy
POSTGRES_PASSWORD=pharmacy
POSTGRES_PORT=15432

# Optional DB GUI (docker compose --profile tools up)
PGADMIN_DEFAULT_EMAIL=admin@local
PGADMIN_DEFAULT_PASSWORD=admin
PGADMIN_PORT=5050

# App ports (docker compose)
BACKEND_PORT=9000
FRONTEND_PORT=5173
VITE_API_URL=http://localhost:9000
WATCHFILES_FORCE_POLLING=true
CHOKIDAR_USEPOLLING=true

# Security
# IMPORTANT: set a strong secret in production
SECRET_KEY=dev-secret-change-me

# CORS (backend)
# Comma-separated list for explicit origins.
CORS_ORIGINS=http://localhost:5173,http://127.0.0.1:5173
# Regex for allowing subdomains like http://sunrise.localhost:5173
CORS_ALLOW_ORIGIN_REGEX=^https?://([a-z0-9-]+\.)*localhost(:\d+)?$

# Frontend portal hosts (comma-separated). Any other host is treated as tenant storefront.
VITE_PORTAL_HOSTS=localhost,127.0.0.1,::1

# Optional: bootstrap an initial admin user on startup
PHARMACY_ADMIN_EMAIL=admin@example.com
PHARMACY_ADMIN_PASSWORD=change-me
PHARMACY_ADMIN_FULL_NAME=Admin

# AI provider selection: openai | openrouter | stub
AI_PROVIDER=openrouter

# OpenRouter (LLM + embeddings)
OPENROUTER_API_KEY=
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
OPENROUTER_ROUTER_MODEL=google/gemini-2.0-flash-001
OPENROUTER_MAIN_MODEL=openai/gpt-4o-mini
OPENROUTER_FALLBACK_MODEL=meta-llama/llama-3.3-70b-instruct
# embeddings stays separate and stable for RAG
OPENROUTER_EMBED_MODEL=openai/text-embedding-3-small
OPENROUTER_EMBED_DIM=1536
# Optional (recommended by OpenRouter)
OPENROUTER_HTTP_REFERER=http://localhost:5173
OPENROUTER_X_TITLE=Pharmacy Assistant

# Email reminders (SMTP)
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USERNAME=your_smtp_user
SMTP_PASSWORD=your_smtp_password
SMTP_FROM=appointments@example.com

# Email reminders (Resend)
RESEND_API_KEY=your_resend_api_key
RESEND_FROM=Pharmacy <onboarding@resend.dev>

# Reminder scheduler
ENABLE_APPOINTMENT_REMINDERS=false
REMINDER_POLL_SECONDS=300
# Timeouts/retries
OPENROUTER_TIMEOUT_SECONDS=30
OPENROUTER_MAX_RETRIES=1
# Keep responses shorter/faster
OPENROUTER_MAX_TOKENS=400
OPENROUTER_ROUTER_MAX_TOKENS=150
OPENROUTER_MAIN_MAX_TOKENS=600
OPENROUTER_FALLBACK_MAX_TOKENS=900

RAG_TOP_K=6
RAG_MIN_SCORE=0.35
RAG_MIN_SCORE_SHORT=0.15
# SQL-first medicine lookup count (before vector/keyword RAG)
RAG_INVENTORY_TOP_K=4
# RAG retrieval modes:
# - vector (default): embeddings + pgvector (best quality)
# - hybrid: vector + keyword scoring (usually best UX, slower than vector)
# - keyword: no embeddings needed (DeepSeek-only setup, less semantic)
RAG_RETRIEVAL_MODE=vector
# Enable embeddings during /ai/rag/reindex (set 0 for DeepSeek-only keyword mode)
RAG_EMBEDDINGS_ENABLED=1
# Truncate retrieved SOURCES sent to the model (reduces latency/cost)
RAG_SOURCES_MAX_CHARS=6000
